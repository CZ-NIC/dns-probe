*************
Exported data
*************

DNS Probe exports data in one of two formats -
`Parquet <https://parquet.apache.org/>`_ or
`C-DNS <https://tools.ietf.org/html/rfc8618>`_. The exported data tries
to conform to the `Entrada
schema <https://entrada.sidnlabs.nl/datamodel/>`_ for Hadoop. Parquet
export simply copies the Entrada schema shown in the table below. C-DNS
format has its own schema defined in `RFC
8616 <https://tools.ietf.org/html/rfc8618>`_. DNS Probe tries to fill
this C-DNS schema with only the data needed for reconstructing the
Entrada schema.

+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| Entrada (Parquet) fields        | type      | C-DNS schema field                   | Comment                                                     |
+=================================+===========+======================================+=============================================================+
| id                              | INT32     | transaction-id                       | 16-bit DNS ID                                               |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| unixtime                        | INT64     | earliest-time, time-offset           | Seconds since Epoch                                         |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| time                            | INT64     | earliest-time, time-offset           | Microseconds since Epoch                                    |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| qname                           | STRING    | query-name-index                     | Full qname, without final dot                               |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| domainname                      | STRING    | query-name-index                     | Last two domains (or TLD + 1 label)                         |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| len                             | INT32     | XXX                                  | Request packet length                                       |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| frag                            | INT32     | XXX                                  | Fragmentation? (Always 0 in Parquet)                        |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| ttl                             | INT32     | client-hoplimit                      | Request TTL                                                 |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| ipv                             | INT32     | qr-transport-flags                   | IP version: 4 / 6                                           |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| prot                            | INT32     | qr-transport-flags                   | TCP/UDP/... (value such as "17" =UDP)                       |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| src                             | STRING    | client-address-index                 | Source (client) IP                                          |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| srcp                            | INT32     | client-port                          | Source (client) port                                        |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| dst                             | STRING    | server-address-index                 | Destination (server) IP                                     |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| dstp                            | INT32     | server-port                          | Destination (server) port                                   |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| udp\_sum                        | INT32     | XXX                                  | UDP checksum                                                |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| dns\_len                        | INT32     | query-size                           | Request DNS payload length                                  |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| aa                              | BOOLEAN   | qr-dns-flags                         | Response AA flag                                            |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| tc                              | BOOLEAN   | qr-dns-flags                         | Response TC flag                                            |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| rd                              | BOOLEAN   | qr-dns-flags                         | Request RD flag                                             |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| ra                              | BOOLEAN   | qr-dns-flags                         | Request RA flag                                             |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| z                               | BOOLEAN   | qr-dns-flags                         | Request Z flag                                              |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| ad                              | BOOLEAN   | qr-dns-flags                         | Request AD flag                                             |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| cd                              | BOOLEAN   | qr-dns-flags                         | Request CD flag                                             |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| ancount                         | INT32     | query-ancount                        | Answers count                                               |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| arcount                         | INT32     | query-arcount                        | Additional records count                                    |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| nscount                         | INT32     | query-nscount                        | Authority records count                                     |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| qdcount                         | INT32     | query-qdcount                        | Questions count                                             |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| opcode                          | INT32     | query-opcode                         | Request opcode (=response)                                  |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| rcode                           | INT32     | response-rcode                       | Response code                                               |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| qtype                           | INT32     | type                                 | Query type                                                  |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| qclass                          | INT32     | class                                | Query class                                                 |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| country                         | STRING    | query-name-index                     | 2 letter code ("CZ", ..) (always empty string in Parquet)   |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| asn                             | STRING    | query-name-index                     | ASN ("AS1234", ...) (always empty string in Parquet)        |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_udp                       | INT32     | query-udp-size                       | UDP payload                                                 |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_version                   | INT32     | query-edns-version                   | EDNS version                                                |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_do                        | BOOLEAN   | qr-dns-flags                         | DO bit                                                      |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_ping                      | BOOLEAN   | response-extended.additional-index   | Tough to detect! (always false in Parquet)                  |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_nsid                      | STRING    | response-extended.additional-index   | NSID string                                                 |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_dnssec\_dau               | STRING    | query-opt-rdata-index                | Comma-separated list "1,3,5"                                |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_dnssec\_dhu               | STRING    | query-opt-rdata-index                | Comma-separated list "1,3,5"                                |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_dnssec\_n3u               | STRING    | query-opt-rdata-index                | Comma-separated list "1,3,5"                                |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_client\_subnet            | STRING    | query-opt-rdata-index                | Always empty string in Parquet                              |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_other                     | STRING    | query-opt-rdata-index                | Always empty string in Parquet                              |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_client\_subnet\_asn       | STRING    | query-opt-rdata-index                | By IP list (Maxmind) (always empty string in Parquet)       |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| edns\_client\_subnet\_country   | STRING    | query-opt-rdata-index                | By IP list (Maxmind) (always empty string in Parquet)       |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| labels                          | INT32     | query-name-index                     | Number of qname labels                                      |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| res\_len                        | INT32     | XXX                                  | Response packet length                                      |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| time\_micro                     | INT64     | earliest-time, time-offset           | Microseconds part of ``time`` field                         |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| resp\_frag                      | INT32     | XXX                                  | Unknown (always 0 in Parquet)                               |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| proc\_time                      | INT32     | XXX                                  | Unknown (always 0 in Parquet)                               |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| is\_google                      | BOOLEAN   | XXX                                  | By IP list (Maxmind) (always false in Parquet)              |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| is\_opendns                     | BOOLEAN   | XXX                                  | By IP list (Maxmind) (always false in Parquet)              |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| dns\_res\_len                   | INT32     | response-size                        | Response DNS payload length                                 |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| server\_location                | STRING    | XXX                                  | Server location (allways empty string in Parquet)           |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+
| tcp\_hs\_rtt                    | INT64     | response-delay                       | TCP Round Trip Time (RTT) (millisecond precision)           |
+---------------------------------+-----------+--------------------------------------+-------------------------------------------------------------+