image: registry.nic.cz/adam/dns-probe:latest

stages:
  - build_and_test
  - deploy

build_and_test:
  stage: build_and_test
  script:
    - mkdir build
    - cd build
    - cmake -DDPDK_BACKEND=ON -DAF_PACKET_BACKEND=ON ..
    - make
    - cd ../tests
    - python3 ./run_tests.py -p ../build/dns-probe-af

pages:
  stage: deploy
  script:
    - mkdir build
    - cd build
    - cmake ..
    - make doc
    - mv doc/html/ ../public/
  artifacts:
    paths:
      - public
  only:
    - master
